On Alps uenv is deployed using RPMs, generated by the tools in this path.

## what version of slurm is on the systems?

run the following script

```bash
#!/bin/bash

for vcluster in balfrin balfrinew besso beverin bristen cavel clariden daint eiger santis; do
  version=$(ssh $vcluster -- srun --version | awk '{print $2}');
  printf "%15s%10s\n" "$vcluster" "$version"
done
```

## up to v8.1.0

The RPMs were deployed in cscs-utilities, e.g:

```
https://jfrog.svc.cscs.ch/artifactory/cscs-utilities/uenv-8.1.0-23.02.6.x86_64.rpm
```

Here is a table of the slurm versions supported on each uarch for v8.1.0:

```
-----------------
x86_64    aarch64
-----------------
23.02.6   -
23.02.7   -
24.05.4   24.05.4
24.05.8   24.05.8
24.11.5   24.11.5
25.05.0   25.05.0
25.05.1   25.05.1
25.05.2   25.05.2
```

# v9.0.0 and later

Move the location to a more central location, in order to 

https://jfrog.svc.cscs.ch/artifactory/cscs-opensuse-$(os)-rpm/uenv/$(arch)/uenv-(version)-(slurm).rpm

where `os` is one of `[15.5, 15.6]`,  and `arch` is one of `[x86_64, aarch64]`

The following slurm versions were detected on the clusters

```
        balfrin   23.02.7
      balfrinew   23.02.7
          besso   24.05.4
        beverin   24.05.4
          cavel   25.05.0
       clariden   24.05.4
          daint   24.05.4
          eiger   24.05.4
         santis   24.05.4
          zinal   24.05.8
```

I.e. we have the following versions: `[25.05.0 24.05.4 24.05.8 23.02.7]`

run the following script on each of os:
- `x86_64`
- `aarch64`

in the following os containers
- `suse-5.5`
- `suse-5.6`

```bash

arch=$(uname -m)
for os in 15.5 15.6
do
    podman build -f ./dockerfiles/sles$os . -t uenv-sles$os
    for slurm in 25.05.0 24.05.4 23.02.7
    do
        podman run -v $(pwd):/work:rw -w /work \
                   -v $(realpath ..):/source:rw \
                   -it uenv-sles$os:latest \
                   sh -c "./suse-build.sh --slurm-version=$slurm --ref=HEAD"

        curl -u$USER:$TOKEN -XPUT \
            https://jfrog.svc.cscs.ch/artifactory/cscs-opensuse-${os}-rpm/uenv/${arch}/uenv-9.0.0-${slurm}.rpm \
            --upload-file rpms/${arch}/uenv-9.0.0-${slurm}.rpm
    done
    push image
done
```

```
export arch=x86_64
export os=15.5
export slurm=24.05.8
echo curl -u$USER:$TOKEN -XPUT https://jfrog.svc.cscs.ch/artifactory/cscs-opensuse-${os}-rpm/uenv/${arch}/uenv-9.0.0-${slurm}.rpm --upload-file rpms/${arch}/uenv-9.0.0-${slurm}.rpm
```

## workflow

Create a new script that merges both build.sh and rpmbuild-wrapper.sh

build-rpm.sh (can we add this to the container image?)

each build container contains the script that is required to

```
./package --os=sles-15.5 --slurm=25.05.4

# uses the container uenv-sles-15.5
```

will generate

```
packages/suse15.5/$arch/
```


        curl -u$USER:$TOKEN -XPUT \
            https://jfrog.svc.cscs.ch/artifactory/cscs-opensuse-${os}/uenv/${arch}/uenv-9.0.0-${slurm}.rpm \
            --upload-file rpms/${arch}/uenv-9.0.0-${slurm}.rpm

